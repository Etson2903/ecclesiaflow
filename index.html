<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcclesiaFlow - AD Varge√£o</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EcclesiaFlow">
    <meta name="description" content="Sistema de Recep√ß√£o - Assembleia de Deus Varge√£o">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxZTQwYWYiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyem0tMiAxNWwtNS01IDEuNDEtMS40MUwxMCAxNC4xN2w3LjU5LTcuNTlMMTkgOGwtOSA5eiIvPgo8L3N2Zz4KPC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxZTQwYWYiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyem0tMiAxNWwtNS01IDEuNDEtMS40MUwxMCAxNC4xN2w3LjU5LTcuNTlMMTkgOGwtOSA5eiIvPgo8L3N2Zz4KPC9zdmc+">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRWNjbGVzaWFGbG93IC0gQUQgVmFyZ2XDo28iLCJzaG9ydF9uYW1lIjoiRWNjbGVzaWFGbG93IiwiZGVzY3JpcHRpb24iOiJTaXN0ZW1hIGRlIFJlY2Vww6fDo28gLSBBc3NlbWJsZWlhIGRlIERldXMgVmFyZ2XDo28iLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMWU0MGFmIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRreUlpQm9aV2xuYUhROUlqRTVNaUlpSUhacFpYZENiM2c5SWpBZ01DQXhPVElnTVRreUlpQm1hV3hzUFNKdWIyNWxJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQZ3B5WldOMElIZHBaSFJvUFNJeE9USWlJR2hsYVdkb2REMGlNVGt5SWlCeWVEMGlNalFpSUdacGJHdzlJaU14WlRRd1lXWWlMejRLUEhOMlp5QjRQU0kwT0NJZ2VUMGlORGdpSUhkcFpIUm9QU0k1TmlJZ2FHVnBaMmgwUFNJNU5pSWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lpSUdacGJHdzlJbmRvYVhSbElqNEtjR0YwYUNCa1BTSk5NVElnTWtNMkxqUTRJRElnTWlBMkxqUTRJRElnTVRKek5DNDBPQ0F4TUNBeE1DQXhNQ0F4TUMweExqUTRJREV3TFRFd0lERXdVekUzTGpVeUlESWdNVElnTW5wdExUSWdNVFZzTFRVdE5TQXhMalF4TFRFdU5ERk1NVEFnTVRRdU1UZHNOeTQxT1MwM0xqVTVURGt4T1NBNGJDMDVJRGw2SWk4K0Nqd3ZjM1puUGdvOEwzTjJaejQ9Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifSx7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5URXlJaUJvWldsbmFIUTlJalV4TWlJaUlIWnBaWGRDYjNnOUlqQWdNQ0ExTVRJZ05URXlJaUJtYVd4c1BTSnViMjVsSWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGdweVpXTjBJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlpQnllRDBpTWpRaUlHWnBiR3c5SWlNeE16TXpNek1pTHo0S1BITjJaeUI0UFNJeE1qZ2lJSGs5SWpFeU9DSWlJSGRwWkhSb1BTSTFOVGdpSUdobGFXZG9kRDBpTlRVNElpQjJhV1YzUW05NFBTSXdJREFnTWpRZ01qUWlJR1pwYkd3OUluZG9hWFJsSWo0S2NHRjBhQ0JrUFNKTk1USWdNa00yTGpRNElESWdNaUEyTGpRNElESWdNVEp6TkM0ME9DQXhNQ0F4TUNBeE1DQXhNQzAwTGpRNElERXdMVEV3SURFd1V6RTNMalV5SURJZ01USWdNbnB0TFRJZ01UVnNMVFV0TlNBeExqUXhMVEV1TkRGTU1UQWdNVFF1TVRkc05pNDFPUzAzTGpVNVREazVJRGhzTFRrZ09Yb2lMejRLUEhOMlp5QjRQU0l4TkRRaUlIazlJakUwTkNJaUlIZHBaSFJvUFNJeU5EQWlJR2hsYVdkb2REMGlNalF3SWlCMmFXVjNRbTk0UFNJd0lEQWdNalFnTWpRaUlHWnBiR3c5SW5kb2FYUmxJajRLY0dGMGFDQmtQU0pOTVRJZ01rTTJMalE0SURJZ01pQTJMalE0SURJZ01USnpOQzQwT0NBeE1DQXhNQ0F4TUNBeE1DMDBMalE0SURFd0xURXdJREV3VXpFM0xqVXlJRElnTVRJZ01ucHRMVElnTVRWc0xUVXROUzR4TkRFdE1TNDBNVXd4TUNBeE5DNHhOMnd6TGpVNUxUY3VOVGxNTVRrZ09Hd3RPU0E1ZWlJdlBnbzhjR0YwYUNCa1BTSk5NVElnTVRSc01pMDBMalUwTFRRdU5UUWdNaTQwTWkweUxqUXlJRFJzTWk0MU9TMHlMalU1SWk4K0NqeHdZWFJvSUdROUlrMHhNaUF4Tm14dE1pMDBMalUwTFRRdU5UUWdNaTQwTWkweUxqUXlJRFJzTWk0MU9TMHlMalU1SWk4K0NqeHdZWFJvSUdROUlrMHhNaUF4T0d3eUxUUXVOVFF0TkM0MU5DQXlMalF5TFRJdU5ESWdORXd4TmlBeE5Hd3RNaTQxT1MweUxqVTVJaTgrQ2p3dmMzWm5QZ284TDNOMlp6ND0iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration - SUAS CONFIGURA√á√ïES REAIS
        const firebaseConfig = {
            apiKey: "AIzaSyBdGprn_TOPe1DcRRbZ3RV2xM4Keb5MTvQ",
            authDomain: "ecclesiaflow-ad-vargeao-2025.firebaseapp.com",
            databaseURL: "https://ecclesiaflow-ad-vargeao-2025-default-rtdb.firebaseio.com",
            projectId: "ecclesiaflow-ad-vargeao-2025",
            storageBucket: "ecclesiaflow-ad-vargeao-2025.firebasestorage.app",
            messagingSenderId: "13276867737",
            appId: "1:13276867737:web:c4edad5467de0afbc41c08"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Make Firebase available globally
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebasePush = push;
        window.firebaseSet = set;
        window.firebaseOnValue = onValue;
        window.firebaseRemove = remove;
        window.firebaseUpdate = update;
        window.firebaseInitialized = true;

        console.log('üî• Firebase inicializado com sucesso!');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .login-screen, .main-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            background: #1e40af;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #059669;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: #dc2626;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s;
        }

        .tab.active {
            color: #1e40af;
            border-bottom: 3px solid #1e40af;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .data-list {
            background: #f9fafb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .data-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .data-item.new-item {
            animation: newItemPulse 2s ease-in-out;
            border-left-color: #059669;
        }

        @keyframes newItemPulse {
            0% { background-color: #d1fae5; }
            50% { background-color: #a7f3d0; }
            100% { background-color: white; }
        }

        .data-item h4 {
            color: #1e40af;
            margin-bottom: 8px;
        }

        .data-item p {
            margin: 4px 0;
            color: #4b5563;
        }

        .actions {
            margin-top: 10px;
        }

        .hidden {
            display: none !important;
        }

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .role-recepcionista {
            background: #dbeafe;
            color: #1e40af;
        }

        .role-dirigente {
            background: #fef3c7;
            color: #d97706;
        }

        .role-midia {
            background: #d1fae5;
            color: #059669;
        }

        .print-area {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .install-prompt {
            background: #1e40af;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .install-prompt button {
            background: white;
            color: #1e40af;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
        }

        .connection-online {
            background: #d1fae5;
            color: #059669;
        }

        .connection-offline {
            background: #fee2e2;
            color: #dc2626;
        }

        .sync-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #059669;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .firebase-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #059669;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
            }

            .connection-status, .firebase-status {
                position: relative;
                top: auto;
                right: auto;
                bottom: auto;
                margin-bottom: 10px;
                display: block;
                text-align: center;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-area, .print-area * {
                visibility: visible;
            }
            
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Firebase Status -->
        <div id="firebaseStatus" class="firebase-status">
            üî• Firebase Conectado
        </div>

        <!-- Connection Status -->
        <div id="connectionStatus" class="connection-status connection-online">
            <span class="sync-indicator"></span>
            Conectado - Sincroniza√ß√£o ativa
        </div>

        <div class="header">
            <h1>‚õ™ EcclesiaFlow</h1>
            <p>Sistema de Recep√ß√£o - Assembleia de Deus Varge√£o, SC</p>
        </div>

        <!-- Install Prompt -->
        <div id="installPrompt" class="install-prompt hidden">
            üì± Instale o EcclesiaFlow no seu dispositivo para acesso r√°pido!
            <button onclick="installApp()">Instalar App</button>
            <button onclick="hideInstallPrompt()">Agora n√£o</button>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e40af;">üîê Acesso ao Sistema</h2>
                
                <div class="form-group">
                    <label for="username">üë§ Usu√°rio:</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio">
                </div>
                
                <div class="form-group">
                    <label for="password">üîë Senha:</label>
                    <input type="password" id="password" placeholder="Digite sua senha">
                </div>
                
                <div class="form-group">
                    <label for="role">üë• Fun√ß√£o:</label>
                    <select id="role">
                        <option value="">Selecione sua fun√ß√£o</option>
                        <option value="recepcionista">üëã Recepcionista</option>
                        <option value="dirigente">üé§ Dirigente</option>
                        <option value="midia">üì∫ M√≠dia</option>
                    </select>
                </div>
                
                <button class="btn" onclick="login()" style="width: 100%; margin-top: 20px;">
                    üöÄ Entrar no Sistema
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <span id="userRole" class="role-badge"></span>
                    <h2 id="welcomeMessage">Bem-vindo ao Sistema!</h2>
                </div>
                <button class="btn btn-secondary" onclick="logout()">üö™ Sair</button>
            </div>

            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('cadastro')" id="tabCadastro">üìù Cadastros</button>
                <button class="tab" onclick="showTab('visualizar')" id="tabVisualizar">üëÅÔ∏è Visualizar</button>
                <button class="tab" onclick="showTab('relatorios')" id="tabRelatorios">üìä Relat√≥rios</button>
            </div>

            <!-- Cadastro Tab -->
            <div id="cadastro" class="tab-content active">
                <div class="tabs" style="border-bottom: 1px solid #e5e7eb;">
                    <button class="tab active" onclick="showSubTab('visitantes')">üë• Visitantes</button>
                    <button class="tab" onclick="showSubTab('louvores')">üéµ Louvores</button>
                    <button class="tab" onclick="showSubTab('oracoes')">üôè Pedidos de Ora√ß√£o</button>
                    <button class="tab" onclick="showSubTab('avisos')">üì¢ Avisos</button>
                </div>

                <!-- Visitantes Form -->
                <div id="visitantes" class="tab-content active" style="margin-top: 20px;">
                    <h3>üë• Cadastro de Visitantes</h3>
                    <form onsubmit="cadastrarVisitante(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome Completo:</label>
                                <input type="text" id="visitanteNome" required>
                            </div>
                            <div class="form-group">
                                <label>Cidade:</label>
                                <input type="text" id="visitanteCidade" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefone (WhatsApp):</label>
                                <input type="tel" id="visitanteTelefone" placeholder="(49) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label>Como conheceu a igreja:</label>
                                <select id="visitanteOrigem">
                                    <option value="">Selecione</option>
                                    <option value="Convite de membro">Convite de membro</option>
                                    <option value="Redes sociais">Redes sociais</option>
                                    <option value="Passou em frente">Passou em frente</option>
                                    <option value="Evento especial">Evento especial</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">üíæ Cadastrar Visitante</button>
                    </form>
                </div>

                <!-- Louvores Form -->
                <div id="louvores" class="tab-content" style="margin-top: 20px;">
                    <h3>üéµ Cadastro de Louvores</h3>
                    <form onsubmit="cadastrarLouvor(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome do Cantor/Grupo:</label>
                                <input type="text" id="louvorCantor" required>
                            </div>
                            <div class="form-group">
                                <label>Nome da M√∫sica:</label>
                                <input type="text" id="louvorMusica" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Hor√°rio (opcional):</label>
                                <input type="time" id="louvorHorario">
                            </div>
                            <div class="form-group">
                                <label>Observa√ß√µes:</label>
                                <input type="text" id="louvorObs" placeholder="Ex: Playback, viol√£o, etc.">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">üéµ Cadastrar Louvor</button>
                    </form>
                </div>

                <!-- Ora√ß√µes Form -->
                <div id="oracoes" class="tab-content" style="margin-top: 20px;">
                    <h3>üôè Pedidos de Ora√ß√£o</h3>
                    <form onsubmit="cadastrarOracao(event)">
                        <div class="form-group">
                            <label>Nome do Solicitante:</label>
                            <input type="text" id="oracaoNome" required>
                        </div>
                        <div class="form-group">
                            <label>Pedido de Ora√ß√£o:</label>
                            <textarea id="oracaoPedido" rows="4" required placeholder="Descreva o pedido de ora√ß√£o..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="oracaoPrivado"> 
                                Pedido privado (n√£o ser√° lido publicamente)
                            </label>
                        </div>
                        <button type="submit" class="btn btn-success">üôè Cadastrar Pedido</button>
                    </form>
                </div>

                <!-- Avisos Form -->
                <div id="avisos" class="tab-content" style="margin-top: 20px;">
                    <h3>üì¢ Cadastro de Avisos</h3>
                    <form onsubmit="cadastrarAviso(event)">
                        <div class="form-group">
                            <label>T√≠tulo do Aviso:</label>
                            <input type="text" id="avisoTitulo" required>
                        </div>
                        <div class="form-group">
                            <label>Conte√∫do do Aviso:</label>
                            <textarea id="avisoConteudo" rows="4" required placeholder="Digite o conte√∫do do aviso..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Prioridade:</label>
                                <select id="avisoPrioridade">
                                    <option value="normal">Normal</option>
                                    <option value="importante">Importante</option>
                                    <option value="urgente">Urgente</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Respons√°vel:</label>
                                <input type="text" id="avisoResponsavel" placeholder="Nome do respons√°vel">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">üì¢ Cadastrar Aviso</button>
                    </form>
                </div>
            </div>

            <!-- Visualizar Tab -->
            <div id="visualizar" class="tab-content">
                <h3>üëÅÔ∏è Dados Cadastrados</h3>
                
                <div class="tabs" style="border-bottom: 1px solid #e5e7eb;">
                    <button class="tab active" onclick="showDataTab('dadosVisitantes')" id="tabDadosVisitantes">üë• Visitantes</button>
                    <button class="tab" onclick="showDataTab('dadosLouvores')" id="tabDadosLouvores">üéµ Louvores</button>
                    <button class="tab" onclick="showDataTab('dadosOracoes')" id="tabDadosOracoes">üôè Ora√ß√µes</button>
                    <button class="tab" onclick="showDataTab('dadosAvisos')" id="tabDadosAvisos">üì¢ Avisos</button>
                </div>

                <div id="dadosVisitantes" class="tab-content active data-list"></div>
                <div id="dadosLouvores" class="tab-content data-list"></div>
                <div id="dadosOracoes" class="tab-content data-list"></div>
                <div id="dadosAvisos" class="tab-content data-list"></div>
            </div>

            <!-- Relat√≥rios Tab -->
            <div id="relatorios" class="tab-content">
                <h3>üìä Relat√≥rios e Impress√£o</h3>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="gerarRelatorio()">üìã Gerar Relat√≥rio Completo</button>
                    <button class="btn btn-success" onclick="imprimirRelatorio()">üñ®Ô∏è Imprimir (T√©rmica 80mm)</button>
                </div>

                <div id="relatorioContent" class="print-area">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2>‚õ™ ASSEMBLEIA DE DEUS</h2>
                        <p><strong>Varge√£o - SC</strong></p>
                        <p>Relat√≥rio de Recep√ß√£o - <span id="dataRelatorio"></span></p>
                        <hr>
                    </div>
                    
                    <div id="relatorioDetalhes">
                        <p style="text-align: center; color: #666;">Clique em "Gerar Relat√≥rio" para visualizar os dados</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let dados = {
            visitantes: {},
            louvores: {},
            oracoes: {},
            avisos: {}
        };
        let deferredPrompt;
        let isOnline = navigator.onLine;

        // Wait for Firebase to initialize
        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.firebaseInitialized) {
                        resolve();
                    } else {
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        // Firebase Functions
        async function initializeFirebaseListeners() {
            await waitForFirebase();
            
            const today = new Date().toISOString().split('T')[0];
            
            // Listen to all data types
            ['visitantes', 'louvores', 'oracoes', 'avisos'].forEach(tipo => {
                const dataRef = window.firebaseRef(window.firebaseDB, `ecclesiaflow/${today}/${tipo}`);
                window.firebaseOnValue(dataRef, (snapshot) => {
                    const data = snapshot.val();
                    dados[tipo] = data || {};
                    updateDataDisplay();
                    showSyncIndicator();
                });
            });

            showNotification('üî• Sincroniza√ß√£o Firebase ativa!');
        }

        async function saveToFirebase(tipo, data) {
            await waitForFirebase();
            
            const today = new Date().toISOString().split('T')[0];
            const dataRef = window.firebaseRef(window.firebaseDB, `ecclesiaflow/${today}/${tipo}`);
            const newRef = window.firebasePush(dataRef);
            await window.firebaseSet(newRef, data);
            
            showNotification(`‚úÖ ${tipo.charAt(0).toUpperCase() + tipo.slice(1)} sincronizado!`);
            return newRef.key;
        }

        async function updateFirebaseItem(tipo, id, data) {
            await waitForFirebase();
            
            const today = new Date().toISOString().split('T')[0];
            const itemRef = window.firebaseRef(window.firebaseDB, `ecclesiaflow/${today}/${tipo}/${id}`);
            await window.firebaseUpdate(itemRef, data);
            
            showNotification(`‚úÖ ${tipo.charAt(0).toUpperCase() + tipo.slice(1)} atualizado!`);
        }

        async function deleteFromFirebase(tipo, id) {
            await waitForFirebase();
            
            const today = new Date().toISOString().split('T')[0];
            const itemRef = window.firebaseRef(window.firebaseDB, `ecclesiaflow/${today}/${tipo}/${id}`);
            await window.firebaseRemove(itemRef);
            
            showNotification(`üóëÔ∏è ${tipo.charAt(0).toUpperCase() + tipo.slice(1)} exclu√≠do!`);
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA instalado');
                    }
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            }
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').classList.add('hidden');
        }

        // Connection Status
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (isOnline) {
                statusElement.className = 'connection-status connection-online';
                statusElement.innerHTML = '<span class="sync-indicator"></span>Conectado - Sincroniza√ß√£o ativa';
            } else {
                statusElement.className = 'connection-status connection-offline';
                statusElement.innerHTML = '‚ö†Ô∏è Offline - Dados ser√£o sincronizados quando conectar';
            }
        }

        window.addEventListener('online', () => {
            isOnline = true;
            updateConnectionStatus();
            initializeFirebaseListeners();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateConnectionStatus();
        });

        // Notifications
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: #059669;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1001;
                font-weight: 600;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }

        function showSyncIndicator() {
            const indicator = document.querySelector('.sync-indicator');
            if (indicator) {
                indicator.style.animation = 'none';
                setTimeout(() => {
                    indicator.style.animation = 'pulse 2s infinite';
                }, 10);
            }
        }

        // Login System
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            // Simple authentication
            const users = {
                'etson': { password: '123', roles: ['recepcionista', 'dirigente', 'midia'] },
                'recepcionista': { password: '123', roles: ['recepcionista'] },
                'dirigente': { password: '123', roles: ['dirigente'] },
                'midia': { password: '123', roles: ['midia'] }
            };

            if (users[username] && users[username].password === password && 
                users[username].roles.includes(role)) {
                
                currentUser = { username, role };
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                setupUserInterface();
                initializeFirebaseListeners();
                showNotification(`üéâ Bem-vindo, ${username}!`);
            } else {
                alert('‚ùå Usu√°rio, senha ou fun√ß√£o incorretos!');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            
            // Clear form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('role').value = '';
        }

        function setupUserInterface() {
            const roleElement = document.getElementById('userRole');
            const welcomeElement = document.getElementById('welcomeMessage');
            
            const roleConfig = {
                'recepcionista': {
                    class: 'role-recepcionista',
                    text: 'üëã Recepcionista',
                    welcome: `Ol√°, ${currentUser.username}! Gerencie os cadastros da igreja.`
                },
                'dirigente': {
                    class: 'role-dirigente', 
                    text: 'üé§ Dirigente',
                    welcome: `Bem-vindo, ${currentUser.username}! Visualize e edite todos os dados.`
                },
                'midia': {
                    class: 'role-midia',
                    text: 'üì∫ M√≠dia', 
                    welcome: `Ol√°, ${currentUser.username}! Acesse louvores e avisos.`
                }
            };

            const config = roleConfig[currentUser.role];
            roleElement.className = `role-badge ${config.class}`;
            roleElement.textContent = config.text;
            welcomeElement.textContent = config.welcome;

            // Hide/show tabs based on role
            if (currentUser.role === 'midia') {
                document.getElementById('tabCadastro').style.display = 'none';
                document.getElementById('tabDadosVisitantes').style.display = 'none';
                document.getElementById('tabDadosOracoes').style.display = 'none';
                showTab('visualizar');
                showDataTab('dadosLouvores');
            } else {
                document.getElementById('tabCadastro').style.display = 'block';
                document.getElementById('tabDadosVisitantes').style.display = 'block';
                document.getElementById('tabDadosOracoes').style.display = 'block';
            }
        }

        // Tab Navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showSubTab(tabName) {
            const parent = event.target.closest('.tab-content');
            parent.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            parent.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showDataTab(tabName) {
            document.querySelectorAll('#visualizar .tab-content').forEach(tab => {
                if (tab.id.startsWith('dados')) {
                    tab.classList.remove('active');
                }
            });
            document.querySelectorAll('#visualizar .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Registration Functions
        async function cadastrarVisitante(event) {
            event.preventDefault();
            
            const visitante = {
                nome: document.getElementById('visitanteNome').value,
                cidade: document.getElementById('visitanteCidade').value,
                telefone: document.getElementById('visitanteTelefone').value,
                origem: document.getElementById('visitanteOrigem').value,
                data: new Date().toLocaleString('pt-BR'),
                cadastradoPor: currentUser.username,
                timestamp: Date.now()
            };

            try {
                await saveToFirebase('visitantes', visitante);
                
                // Send WhatsApp message
                if (visitante.telefone) {
                    enviarWhatsApp(visitante);
                }
                
                // Clear form
                event.target.reset();
                
                showNotification('‚úÖ Visitante cadastrado com sucesso!');
            } catch (error) {
                console.error('Erro ao cadastrar visitante:', error);
                showNotification('‚ùå Erro ao cadastrar visitante!');
            }
        }

        async function cadastrarLouvor(event) {
            event.preventDefault();
            
            const louvor = {
                cantor: document.getElementById('louvorCantor').value,
                musica: document.getElementById('louvorMusica').value,
                horario: document.getElementById('louvorHorario').value,
                observacoes: document.getElementById('louvorObs').value,
                data: new Date().toLocaleString('pt-BR'),
                cadastradoPor: currentUser.username,
                timestamp: Date.now()
            };

            try {
                await saveToFirebase('louvores', louvor);
                event.target.reset();
                showNotification('üéµ Louvor cadastrado com sucesso!');
            } catch (error) {
                console.error('Erro ao cadastrar louvor:', error);
                showNotification('‚ùå Erro ao cadastrar louvor!');
            }
        }

        async function cadastrarOracao(event) {
            event.preventDefault();
            
            const oracao = {
                nome: document.getElementById('oracaoNome').value,
                pedido: document.getElementById('oracaoPedido').value,
                privado: document.getElementById('oracaoPrivado').checked,
                data: new Date().toLocaleString('pt-BR'),
                cadastradoPor: currentUser.username,
                timestamp: Date.now()
            };

            try {
                await saveToFirebase('oracoes', oracao);
                event.target.reset();
                showNotification('üôè Pedido de ora√ß√£o cadastrado com sucesso!');
            } catch (error) {
                console.error('Erro ao cadastrar ora√ß√£o:', error);
                showNotification('‚ùå Erro ao cadastrar pedido!');
            }
        }

        async function cadastrarAviso(event) {
            event.preventDefault();
            
            const aviso = {
                titulo: document.getElementById('avisoTitulo').value,
                conteudo: document.getElementById('avisoConteudo').value,
                prioridade: document.getElementById('avisoPrioridade').value,
                responsavel: document.getElementById('avisoResponsavel').value,
                data: new Date().toLocaleString('pt-BR'),
                cadastradoPor: currentUser.username,
                timestamp: Date.now()
            };

            try {
                await saveToFirebase('avisos', aviso);
                event.target.reset();
                showNotification('üì¢ Aviso cadastrado com sucesso!');
            } catch (error) {
                console.error('Erro ao cadastrar aviso:', error);
                showNotification('‚ùå Erro ao cadastrar aviso!');
            }
        }

        // WhatsApp Integration
        function enviarWhatsApp(visitante) {
            const mensagem = `üôè Ol√° ${visitante.nome}!

Que alegria ter voc√™ conosco hoje na Assembleia de Deus de Varge√£o! 

‚ú® Foi uma b√™n√ß√£o conhec√™-lo(a) e esperamos que tenha se sentido em casa.

üìç Nossa igreja est√° sempre de portas abertas para voc√™ e sua fam√≠lia. Venha nos visitar sempre que desejar!

ü§ù Se precisar de ora√ß√£o ou quiser conversar, estamos aqui.

Que Deus aben√ßoe sua vida!

‚õ™ Assembleia de Deus - Varge√£o, SC
üôè "Porque onde estiverem dois ou tr√™s reunidos em meu nome, a√≠ estou eu no meio deles." - Mateus 18:20`;

            const telefone = visitante.telefone.replace(/\D/g, '');
            const url = `https://wa.me/55${telefone}?text=${encodeURIComponent(mensagem)}`;
            
            if (confirm(`üì± Enviar mensagem de boas-vindas para ${visitante.nome}?`)) {
                window.open(url, '_blank');
            }
        }

        // Data Display
        function updateDataDisplay() {
            updateVisitantesDisplay();
            updateLouvoresDisplay();
            updateOracoesDisplay();
            updateAvisosDisplay();
        }

        function updateVisitantesDisplay() {
            const container = document.getElementById('dadosVisitantes');
            container.innerHTML = '';

            const visitantesArray = Object.entries(dados.visitantes || {}).map(([id, data]) => ({id, ...data}));
            
            if (visitantesArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum visitante cadastrado hoje.</p>';
                return;
            }

            // Sort by timestamp (newest first)
            visitantesArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            visitantesArray.forEach(visitante => {
                const div = document.createElement('div');
                div.className = 'data-item';
                
                // Check if item is new (less than 30 seconds old)
                const isNew = visitante.timestamp && (Date.now() - visitante.timestamp) < 30000;
                if (isNew) {
                    div.classList.add('new-item');
                }
                
                div.innerHTML = `
                    <h4>üë§ ${visitante.nome} ${isNew ? 'üÜï' : ''}</h4>
                    <p><strong>üèôÔ∏è Cidade:</strong> ${visitante.cidade}</p>
                    <p><strong>üì± Telefone:</strong> ${visitante.telefone || 'N√£o informado'}</p>
                    <p><strong>ü§ù Como conheceu:</strong> ${visitante.origem || 'N√£o informado'}</p>
                    <p><strong>‚è∞ Cadastrado em:</strong> ${visitante.data}</p>
                    <p><strong>üë§ Por:</strong> ${visitante.cadastradoPor}</p>
                    ${canEdit() ? `
                        <div class="actions">
                            <button class="btn btn-secondary" onclick="editarItem('visitantes', '${visitante.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirItem('visitantes', '${visitante.id}')">üóëÔ∏è Excluir</button>
                            ${visitante.telefone ? `<button class="btn btn-success" onclick="reenviarWhatsApp('${visitante.id}')">üì± Reenviar WhatsApp</button>` : ''}
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        function updateLouvoresDisplay() {
            const container = document.getElementById('dadosLouvores');
            container.innerHTML = '';

            const louvoresArray = Object.entries(dados.louvores || {}).map(([id, data]) => ({id, ...data}));
            
            if (louvoresArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum louvor cadastrado hoje.</p>';
                return;
            }

            // Sort by timestamp (newest first)
            louvoresArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            louvoresArray.forEach(louvor => {
                const div = document.createElement('div');
                div.className = 'data-item';
                
                const isNew = louvor.timestamp && (Date.now() - louvor.timestamp) < 30000;
                if (isNew) {
                    div.classList.add('new-item');
                }
                
                div.innerHTML = `
                    <h4>üéµ ${louvor.musica} ${isNew ? 'üÜï' : ''}</h4>
                    <p><strong>üë§ Cantor/Grupo:</strong> ${louvor.cantor}</p>
                    <p><strong>‚è∞ Hor√°rio:</strong> ${louvor.horario || 'N√£o definido'}</p>
                    <p><strong>üìù Observa√ß√µes:</strong> ${louvor.observacoes || 'Nenhuma'}</p>
                    <p><strong>üìÖ Cadastrado em:</strong> ${louvor.data}</p>
                    <p><strong>üë§ Por:</strong> ${louvor.cadastradoPor}</p>
                    ${canEdit() ? `
                        <div class="actions">
                            <button class="btn btn-secondary" onclick="editarItem('louvores', '${louvor.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirItem('louvores', '${louvor.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        function updateOracoesDisplay() {
            const container = document.getElementById('dadosOracoes');
            container.innerHTML = '';

            const oracoesArray = Object.entries(dados.oracoes || {}).map(([id, data]) => ({id, ...data}));
            
            if (oracoesArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum pedido de ora√ß√£o cadastrado hoje.</p>';
                return;
            }

            // Sort by timestamp (newest first)
            oracoesArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            oracoesArray.forEach(oracao => {
                const div = document.createElement('div');
                div.className = 'data-item';
                
                const isNew = oracao.timestamp && (Date.now() - oracao.timestamp) < 30000;
                if (isNew) {
                    div.classList.add('new-item');
                }
                
                div.innerHTML = `
                    <h4>üôè ${oracao.nome} ${oracao.privado ? 'üîí' : ''} ${isNew ? 'üÜï' : ''}</h4>
                    <p><strong>üìù Pedido:</strong> ${oracao.pedido}</p>
                    <p><strong>üîí Tipo:</strong> ${oracao.privado ? 'Privado (n√£o ser√° lido)' : 'P√∫blico'}</p>
                    <p><strong>üìÖ Cadastrado em:</strong> ${oracao.data}</p>
                    <p><strong>üë§ Por:</strong> ${oracao.cadastradoPor}</p>
                    ${canEdit() ? `
                        <div class="actions">
                            <button class="btn btn-secondary" onclick="editarItem('oracoes', '${oracao.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirItem('oracoes', '${oracao.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        function updateAvisosDisplay() {
            const container = document.getElementById('dadosAvisos');
            container.innerHTML = '';

            const avisosArray = Object.entries(dados.avisos || {}).map(([id, data]) => ({id, ...data}));
            
            if (avisosArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum aviso cadastrado hoje.</p>';
                return;
            }

            // Sort by timestamp (newest first)
            avisosArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            avisosArray.forEach(aviso => {
                const prioridadeIcon = {
                    'normal': 'üì¢',
                    'importante': '‚ö†Ô∏è',
                    'urgente': 'üö®'
                };

                const div = document.createElement('div');
                div.className = 'data-item';
                
                const isNew = aviso.timestamp && (Date.now() - aviso.timestamp) < 30000;
                if (isNew) {
                    div.classList.add('new-item');
                }
                
                div.innerHTML = `
                    <h4>${prioridadeIcon[aviso.prioridade]} ${aviso.titulo} ${isNew ? 'üÜï' : ''}</h4>
                    <p><strong>üìù Conte√∫do:</strong> ${aviso.conteudo}</p>
                    <p><strong>‚ö° Prioridade:</strong> ${aviso.prioridade.toUpperCase()}</p>
                    <p><strong>üë§ Respons√°vel:</strong> ${aviso.responsavel || 'N√£o informado'}</p>
                    <p><strong>üìÖ Cadastrado em:</strong> ${aviso.data}</p>
                    <p><strong>üë§ Por:</strong> ${aviso.cadastradoPor}</p>
                    ${canEdit() ? `
                        <div class="actions">
                            <button class="btn btn-secondary" onclick="editarItem('avisos', '${aviso.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirItem('avisos', '${aviso.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        // Permission Check
        function canEdit() {
            return currentUser && (currentUser.role === 'dirigente' || currentUser.role === 'recepcionista');
        }

        // Edit and Delete Functions
        async function editarItem(tipo, id) {
            const item = dados[tipo][id];
            if (!item) return;

            let newData = {};
            
            switch(tipo) {
                case 'visitantes':
                    newData.nome = prompt('Nome:', item.nome) || item.nome;
                    newData.cidade = prompt('Cidade:', item.cidade) || item.cidade;
                    newData.telefone = prompt('Telefone:', item.telefone) || item.telefone;
                    newData.origem = prompt('Como conheceu:', item.origem) || item.origem;
                    break;
                    
                case 'louvores':
                    newData.cantor = prompt('Cantor/Grupo:', item.cantor) || item.cantor;
                    newData.musica = prompt('M√∫sica:', item.musica) || item.musica;
                    newData.horario = prompt('Hor√°rio:', item.horario) || item.horario;
                    newData.observacoes = prompt('Observa√ß√µes:', item.observacoes) || item.observacoes;
                    break;
                    
                case 'oracoes':
                    newData.nome = prompt('Nome:', item.nome) || item.nome;
                    newData.pedido = prompt('Pedido:', item.pedido) || item.pedido;
                    newData.privado = confirm('Pedido privado?');
                    break;
                    
                case 'avisos':
                    newData.titulo = prompt('T√≠tulo:', item.titulo) || item.titulo;
                    newData.conteudo = prompt('Conte√∫do:', item.conteudo) || item.conteudo;
                    newData.responsavel = prompt('Respons√°vel:', item.responsavel) || item.responsavel;
                    break;
            }

            try {
                await updateFirebaseItem(tipo, id, newData);
                showNotification('‚úÖ Item atualizado com sucesso!');
            } catch (error) {
                console.error('Erro ao atualizar item:', error);
                showNotification('‚ùå Erro ao atualizar item!');
            }
        }

        async function excluirItem(tipo, id) {
            if (confirm('‚ùå Tem certeza que deseja excluir este item?')) {
                try {
                    await deleteFromFirebase(tipo, id);
                    showNotification('üóëÔ∏è Item exclu√≠do com sucesso!');
                } catch (error) {
                    console.error('Erro ao excluir item:', error);
                    showNotification('‚ùå Erro ao excluir item!');
                }
            }
        }

        function reenviarWhatsApp(visitanteId) {
            const visitante = dados.visitantes[visitanteId];
            if (visitante) {
                enviarWhatsApp(visitante);
            }
        }

        // Reports
        function gerarRelatorio() {
            const agora = new Date();
            document.getElementById('dataRelatorio').textContent = agora.toLocaleString('pt-BR');
            
            let html = '';
            
            // Visitantes
            const visitantesArray = Object.values(dados.visitantes || {});
            if (visitantesArray.length > 0) {
                html += `
                    <div style="margin-bottom: 20px;">
                        <h3>üë• VISITANTES (${visitantesArray.length})</h3>
                        <hr>
                `;
                visitantesArray.forEach((v, index) => {
                    html += `
                        <p><strong>${index + 1}.</strong> ${v.nome} - ${v.cidade}</p>
                    `;
                });
                html += '</div>';
            }

            // Louvores
            const louvoresArray = Object.values(dados.louvores || {});
            if (louvoresArray.length > 0) {
                html += `
                    <div style="margin-bottom: 20px;">
                        <h3>üéµ LOUVORES (${louvoresArray.length})</h3>
                        <hr>
                `;
                louvoresArray.forEach((l, index) => {
                    html += `
                        <p><strong>${index + 1}.</strong> ${l.cantor} - "${l.musica}"${l.horario ? ` (${l.horario})` : ''}</p>
                    `;
                });
                html += '</div>';
            }

            // Pedidos de Ora√ß√£o (apenas p√∫blicos)
            const oracoesArray = Object.values(dados.oracoes || {}).filter(o => !o.privado);
            if (oracoesArray.length > 0) {
                html += `
                    <div style="margin-bottom: 20px;">
                        <h3>üôè PEDIDOS DE ORA√á√ÉO (${oracoesArray.length})</h3>
                        <hr>
                `;
                oracoesArray.forEach((o, index) => {
                    html += `
                        <p><strong>${index + 1}.</strong> ${o.nome} - ${o.pedido}</p>
                    `;
                });
                html += '</div>';
            }

            // Avisos
            const avisosArray = Object.values(dados.avisos || {});
            if (avisosArray.length > 0) {
                html += `
                    <div style="margin-bottom: 20px;">
                        <h3>üì¢ AVISOS (${avisosArray.length})</h3>
                        <hr>
                `;
                avisosArray.forEach((a, index) => {
                    const prioridadeText = a.prioridade === 'urgente' ? ' [URGENTE]' : 
                                         a.prioridade === 'importante' ? ' [IMPORTANTE]' : '';
                    html += `
                        <p><strong>${index + 1}.</strong> ${a.titulo}${prioridadeText}</p>
                        <p style="margin-left: 20px; font-size: 0.9em;">${a.conteudo}</p>
                    `;
                });
                html += '</div>';
            }

            if (!html) {
                html = '<p style="text-align: center; color: #666;">Nenhum dado cadastrado hoje.</p>';
            }

            html += `
                <div style="margin-top: 30px; text-align: center; font-size: 0.8em; color: #666;">
                    <hr>
                    <p>Relat√≥rio gerado em ${agora.toLocaleString('pt-BR')}</p>
                    <p>Sistema EcclesiaFlow - AD Varge√£o</p>
                    <p>üî• Sincroniza√ß√£o Firebase em tempo real ativa</p>
                </div>
            `;

            document.getElementById('relatorioDetalhes').innerHTML = html;
        }

        function imprimirRelatorio() {
            if (document.getElementById('relatorioDetalhes').innerHTML.includes('Clique em')) {
                alert('‚ö†Ô∏è Gere o relat√≥rio primeiro antes de imprimir!');
                return;
            }
            
            window.print();
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'ecclesiaflow-firebase-v1';
                    const urlsToCache = [
                        './',
                        './index.html'
                    ];

                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    return response || fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registrado:', registration);
                    })
                    .catch((error) => {
                        console.log('SW falhou:', error);
                    });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateConnectionStatus();
            
            // Auto-hide install prompt after 10 seconds
            setTimeout(() => {
                hideInstallPrompt();
            }, 10000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                imprimirRelatorio();
            }
        });
    </script>
</body>
</html>
